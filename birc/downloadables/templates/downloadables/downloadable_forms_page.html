{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}

<style>
/* === Hover animation for cards === */
.card {
  background-color: #f5f5f5;
}
.card:hover {  
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}

/* === Accordion header title styling === */
.accordion-button {
  background-color: #f5f5f5;           /* Match card background */
  color: #000 !important;           /* Black text */
  opacity: 0.8 ;
  font-weight: 600;
  box-shadow: none !important;
}

/* When accordion is opened */
.accordion-button:not(.collapsed) {
  background-color: #f8f9fa;        /* Light gray background */
  color: #000 !important;           /* Keep text black */
}

/* Remove focus outlines */
.accordion-button:focus {
  box-shadow: none !important;
}

/* === Make accordion toggle (plus/minus) black === */
.accordion-button::after {
  filter: brightness(0) invert(0);  /* Force black color for the caret/plus */
}

/* === Optional: Card-like hover for accordion === */

.accordion-item:hover {
  
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
}
</style>


<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold">{{ page.title }}</h1>
        {% if page.intro %}
        <div class="lead">{{ page.intro|richtext }}</div>
        {% endif %}
    </div>

    <!-- ============================== -->
    <!-- INDIVIDUAL DOCUMENTS SECTION -->
    <!-- ============================== -->
    {% if files %}
    <section class="mb-5">
        <h3 class="mb-3 border-bottom pb-2">üìÑ Individual Files</h3>
        <div class="row row-cols-1 row-cols-md-2 g-4">
            {% for file in files %}
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    <div class="card-body">
                        <h5 class="card-title fw-semibold">{{ file.title }}</h5>
                        {% if file.description %}
                        <p class="card-text small text-muted">{{ file.description }}</p>
                        {% endif %}
                    </div>
                    <div class="card-footer bg-transparent border-0">
                        <a href="{{ file.file.url }}" class="btn btn-success btn-sm" download>
                            <i class="bi bi-download"></i> Download
                        </a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <!-- ============================== -->
    <!-- GROUPED DOCUMENTS SECTION -->
    <!-- ============================== -->
    {% if groups %}
    <section>
        <h3 class="mb-3 border-bottom pb-2">üìÅ Grouped Documents</h3>
        <div class="accordion" id="groupAccordion">

            {% for group in groups %}
            <div class="accordion-item mb-3 shadow-sm border-0 rounded-3">
                <h2 class="accordion-header" id="heading{{ group.id }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#collapse{{ group.id }}" aria-expanded="false"
                        aria-controls="collapse{{ group.id }}">
                        <strong>{{ group.group_title }}</strong>
                    </button>
                </h2>

                <div id="collapse{{ group.id }}" class="accordion-collapse collapse"
                    aria-labelledby="heading{{ group.id }}" data-bs-parent="#groupAccordion">
                    <div class="accordion-body">

                        {% if group.group_description %}
                        <div class="mb-3">{{ group.group_description|richtext }}</div>
                        {% endif %}

                        <!-- Group image -->
                        {% with first_image=group.subfiles.all|first %}
                            {% if first_image.group_image %}
                                <div class="mb-3 text-center">
                                    {% image first_image.group_image width-800 format-webp as img %}
                                    <img src="{{ img.url }}" width="{{ img.width }}" height="{{ img.height }}" alt="{{ first_image.title }}" class="img-fluid rounded mb-3 shadow-sm">
                                </div>
                            {% endif %}
                        {% endwith %}

                        <!-- Subfiles -->
                        {% if group.subfiles.all %}
                        <ul class="list-group">
                            {% for subfile in group.subfiles.all %}
                            <li class="list-group-item d-flex justify-content-between align-items-start">
                                <div>
                                    <div class="fw-semibold">{{ subfile.title }}</div>
                                    {% if subfile.description %}
                                    <small class="text-muted">{{ subfile.description }}</small>
                                    {% endif %}
                                </div>
                                <a href="{{ subfile.file.url }}" class="btn btn-outline-success btn-sm" download>
                                    <i class="bi bi-download"></i> Download
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-muted fst-italic">No files uploaded for this group yet.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}